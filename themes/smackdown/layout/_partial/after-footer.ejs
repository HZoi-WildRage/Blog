<% if (theme.fancybox){ %>
  <%- css('fancybox/jquery.fancybox') %>
<% } %>

<script>
	var yiliaConfig = {
		fancybox: <%=theme.fancybox%>,
		mathjax: <%=theme.mathjax%>,
		animate: <%=theme.animate%>,
		isHome: <%=is_home()%>,
		isPost: <%=is_post()%>,
		isArchive: <%=is_archive()%>,
		isTag: <%=is_tag()%>,
		isCategory: <%=is_category()%>,
		open_in_new: <%=theme.open_in_new%>
	}
</script>
<%- js('js/main') %>

<% if (theme.JiaThis.enable){ %>
<!-- JiaThis Button BEGIN -->
<script type="text/javascript" >
var jiathis_config={
	data_track_clickback:true,
	summary:"",
	showClose:true,
	shortUrl:false,
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jiathis_r.js?uid=2141587&btn=r3.gif&move=0" charset="utf-8"></script>
<!-- JiaThis Button END -->
<% } %>

<% if(theme.firebase.enable){ %>
<script>
	// var MineblogFirebase = new Firebase(theme.firebase.url);
	var config = {
		apiKey: "<%=theme.firebase.apiKey%>",
		authDomain: "<%=theme.firebase.authDomain%>",
		databaseURL: "<%=theme.firebase.databaseURL%>",
		projectId: "<%=theme.firebase.projectId%>",
		storageBucket: "<%=theme.firebase.storageBucket%>",
		messagingSenderId: "<%=theme.firebase.messagingSenderId%>"
  	};
	firebase.initializeApp(config);
	var MineblogFirebase = firebase.database().ref();
	// 明细由当前页面的url表示，将反斜线替换成下划线，并将中文decode出来
	var current_url = decodeURI(window.location.pathname.replace(new RegExp('\\/|\\.', 'g'),"_"));
	// 获取总数，并将总访问量展示在页面上
	MineblogFirebase.child("sum").on("value", function(data) {
	var current_counter = data.val();
	if( $("#sum_counter").length > 0  && current_counter >1 ){
		$("#sum_counter").html(
				"&nbsp;|&nbsp;总访问量&nbsp;<font style='color:white'>"+ current_counter +"</font>&nbsp;次"
		);
	};
	});
	// 获取明细，并将明细也展示在页面上
	MineblogFirebase.child("detail/"+current_url).on("value", function(data){
		var detail_counter = data.val();
		if($("#detail_counter").length > 0 && detail_counter > 1){
			$("#detail_counter").html(
				"&nbsp;本页访问量&nbsp;<font style='color:white'>"+ detail_counter +"</font>&nbsp;次"
			);
		}
	});
	// 总数+1
	MineblogFirebase.child("sum").transaction(function (current_counter) {
	return (current_counter || 0) + 1;
	});
	// 明细+1
	MineblogFirebase.child("detail/"+current_url).transaction(function (current_counter) {
	return (current_counter || 0) + 1;
	});
</script>

<% } %>

<% if (theme.mathjax){ %>
<%- partial('mathjax') %>
<% } %>